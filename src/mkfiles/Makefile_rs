#Makefile for the DIFFER RS cluster

# Directory for math routines
ROUT = mathlib

# Directory for math routines
CUB = cubpack

# Directory for NAG routines
NAG = /home/emc/citrin/mathlibs

FC=mpif90.openmpi
FFLAGS = -O3 -fdefault-real-8 -fdefault-double-8 -ffree-line-length-none -I$(CUB)
OPENMP = -fopenmp

# Fortran files for QUALIKIZ
OBJS_QUALIKIZ = kind.o mod_io_management.o datmat.o datcal.o dispfuncs.o asymmetry.o mod_make_io.o \
FLRterms.o mod_fluidsol.o mod_contour.o trapints.o passints.o calltrapints.o callpassints.o \
mod_fonct.o callpassQLints.o calltrapQLints.o QLflux.o nanfilter.o calcroutines.o mod_saturation.o qualikiz.o \

all: $(CUB)/libcubpack.a $(ROUT)/librout.a QuaLiKiz.exe
QuaLiKiz.exe: qlk_standalone.f90 qualikiz.f90 $(OBJS_QUALIKIZ) $(ROUT)/librout.a $(CUB)/libcubpack.a
	$(FC) -o QuaLiKiz.exe qlk_standalone.f90 $(OBJS_QUALIKIZ) ${FFLAGS} ${OPENMP} -L$(ROUT) -lrout -L$(CUB) -lcubpack -L$(NAG) -lnag

%.o:%.f90
	$(FC) ${FFLAGS} $(OPENMP) -c $<

$(ROUT)/librout.a:
	cd $(ROUT);make all

$(CUB)/libcubpack.a:
	cd $(CUB);make all

clean:
	rm -f *.o *.exe *.mod

cleantot:
	rm -f *.o *.exe *.mod
	cd $(ROUT); make clean
	cd $(CUB); make veryclean



