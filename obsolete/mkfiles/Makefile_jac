#Makefile for the jac cluster

include archfiles/arch_jac.inc

INCLUDE = -I.

# Directory for various math routines
ROUT = mathlib
INCLUDE+= -I$(ROUT)

# Directory for 2d integration routines
CUB = cubpack
INCLUDE+= -I$(CUB)

# Fortran files for QUALIKIZ
OBJS_QUALIKIZ = kind.o mod_io_management.o datmat.o datcal.o dispfuncs.o asymmetry.o mod_make_io.o \
FLRterms.o mod_fluidsol.o mod_contour.o trapints.o passints.o calltrapints.o callpassints.o \
mod_fonct.o callpassQLints.o calltrapQLints.o QLflux.o nanfilter.o calcroutines.o mod_saturation.o qualikiz.o \

all: $(CUB)/libcubpack.a $(ROUT)/librout.a QuaLiKiz.exe

QuaLiKiz.exe: qlk_standalone.f90 $(OBJS_QUALIKIZ) $(ROUT)/librout.a $(CUB)/libcubpack.a
	$(FC) -o QuaLiKiz.exe qlk_standalone.f90 $(OBJS_QUALIKIZ) $(F90FLAGS) $(INCLUDE) -L$(ROUT) -lrout -L$(CUB) -l$(CUB)

#qlk_makeflux.exe: qlk_makeflux.f90 $(OBJS_MAKEFLUX) $(ROUT)/librout.a
#	$(FC) -o qlk_makeflux.exe qlk_makeflux.f90 $(OBJS_MAKEFLUX) $(F90FLAGS) $(INCLUDE) -L$(ROUT) -lrout

%.o:%.f90
	$(FC) $(OPENMP) $(F90FLAGS) -c $< $(INCLUDE)

$(ROUT)/librout.a:
	cd $(ROUT); make all

$(CUB)/libcubpack.a:
	cd $(CUB); make all

clean:
	rm -f *.o QuaLiKiz.exe *.mod

cleantot:
	rm -f *.o QuaLiKiz.exe *.mod
	cd $(ROUT); make clean
	cd $(CUB); make veryclean


